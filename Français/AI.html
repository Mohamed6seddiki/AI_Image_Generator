<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙˆÙ„Ø¯ Ø§Ù„ØµÙˆØ± Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        input {
            flex: 1;
            padding: 15px 20px;
            font-size: 18px;
            border: 2px solid #667eea;
            border-radius: 10px;
            outline: none;
        }
        button {
            padding: 15px 40px;
            font-size: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { transform: scale(1.05); transition: 0.2s; }
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .image-box {
            background: #f5f5f5;
            border-radius: 15px;
            overflow: hidden;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .image-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ Ù…ÙˆÙ„Ø¯ Ø§Ù„ØµÙˆØ±</h1>
        
        <div class="search-box">
            <input 
                type="text" 
                id="input" 
                placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙ Ø§Ù„ØµÙˆØ±Ø©..."
            >
            <button onclick="generateImage()">ØªÙˆÙ„ÙŠØ¯</button>
        </div>

        <div class="gallery">
            <div class="image-box" id="div1"></div>
            <div class="image-box" id="div2"></div>
            <div class="image-box" id="div3"></div>
        </div>
    </div>

    <script>
        async function generateImage() {
          const input = document.getElementById("input");
          let rawValue = input.value.trim();
          
          if (!rawValue) {
            alert("âš ï¸ Ø§ÙƒØªØ¨ ÙˆØµÙ Ø§Ù„ØµÙˆØ±Ø©");
            return;
          }

          const divs = [
            document.getElementById("div1"),
            document.getElementById("div2"),
            document.getElementById("div3")
          ];

          divs.forEach(div => {
            div.innerHTML = '<div style="color:#666; padding:20px;">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆÙ„ÙŠØ¯...</div>';
          });

          // Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø­Ù„ÙŠØ©
          const value = rawValue.toLowerCase();
          const localImages = { samy: "SAMY", anis: "ANIS", mili: "mili" };

          if (localImages[value]) {
            divs.forEach((div, i) => {
              const img = new Image();
              img.style.opacity = "0";
              img.style.transition = "opacity 0.5s";
              img.src = `${localImages[value]}${i + 1}.jpg`;
              img.onload = () => {
                div.innerHTML = "";
                div.appendChild(img);
                setTimeout(() => img.style.opacity = "1", 10);
              };
              img.onerror = () => div.innerHTML = "âŒ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©";
            });
            return;
          }

          // ØªØ±Ø¬Ù…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
          const translations = {
            'Ù‚Ø·': 'cat', 'ÙƒÙ„Ø¨': 'dog', 'Ù‚Ù„Ù…': 'pen', 'Ø³ÙŠØ§Ø±Ø©': 'car',
            'Ù…Ù†Ø²Ù„': 'house', 'Ø´Ø¬Ø±Ø©': 'tree', 'Ø²Ù‡Ø±Ø©': 'flower',
            'Ø¨Ø­Ø±': 'ocean', 'Ø¬Ø¨Ù„': 'mountain', 'Ø³Ù…Ø§Ø¡': 'sky'
          };
          
          let prompt = rawValue;
          Object.keys(translations).forEach(ar => {
            prompt = prompt.replace(new RegExp(ar, 'gi'), translations[ar]);
          });

          // Ù‚Ø§Ø¦Ù…Ø© APIs Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
          const apis = [
            // API 1: Pollinations Ø§Ù„Ø¬Ø¯ÙŠØ¯
            (p, s) => `https://pollinations.ai/p/${encodeURIComponent(p)}?seed=${s}&width=512&height=512`,
            
            // API 2: Pollinations Ø§Ù„Ù‚Ø¯ÙŠÙ…
            (p, s) => `https://image.pollinations.ai/prompt/${encodeURIComponent(p)}?seed=${s}&width=512&height=512&nologo=true`,
            
            // API 3: Lexica Art
            (p, s) => `https://lexica.art/api/v1/search?q=${encodeURIComponent(p)}`,
            
            // API 4: Placeholder
            (p, s) => `https://via.placeholder.com/512/4A90E2/ffffff?text=${encodeURIComponent(p.substring(0, 20))}`
          ];

          // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ± Ø¨Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠØ©
          for (let i = 0; i < divs.length; i++) {
            const seed = Date.now() + i * 1000;
            let loaded = false;

            // Ø¬Ø±Ø¨ ÙƒÙ„ API Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø­ØªÙ‰ ÙŠÙ†Ø¬Ø­ ÙˆØ§Ø­Ø¯
            for (let apiIndex = 0; apiIndex < apis.length && !loaded; apiIndex++) {
              try {
                const url = apis[apiIndex](prompt, seed);
                console.log(`Ù…Ø­Ø§ÙˆÙ„Ø© API ${apiIndex + 1} Ù„Ù„ØµÙˆØ±Ø© ${i + 1}: ${url}`);

                // Ø­Ø§Ù„Ø© Ø®Ø§ØµØ© Ù„Ù€ Lexica (ÙŠØ¹ÙŠØ¯ JSON)
                if (apiIndex === 2) {
                  const response = await fetch(url);
                  const data = await response.json();
                  if (data.images && data.images.length > 0) {
                    const imgUrl = data.images[Math.floor(Math.random() * Math.min(5, data.images.length))].src;
                    await loadImage(divs[i], imgUrl);
                    loaded = true;
                  }
                } else {
                  // APIs Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
                  await loadImage(divs[i], url);
                  loaded = true;
                }
                
                if (loaded) {
                  console.log(`âœ… Ù†Ø¬Ø­ API ${apiIndex + 1} Ù„Ù„ØµÙˆØ±Ø© ${i + 1}`);
                  break;
                }
              } catch (error) {
                console.log(`âŒ ÙØ´Ù„ API ${apiIndex + 1}:`, error.message);
                continue;
              }
            }

            // Ø¥Ø°Ø§ ÙØ´Ù„Øª ÙƒÙ„ APIs
            if (!loaded) {
              divs[i].innerHTML = '<div style="color:red; padding:20px; text-align:center;">âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„<br><small>Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</small></div>';
            }

            // ØªØ£Ø®ÙŠØ± Ø¨ÙŠÙ† Ø§Ù„ØµÙˆØ±
            await new Promise(resolve => setTimeout(resolve, 500));
          }
        }

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
        function loadImage(container, url) {
          return new Promise((resolve, reject) => {
            const img = new Image();
            img.style.opacity = "0";
            img.style.transition = "opacity 0.5s";
            img.crossOrigin = "anonymous";
            
            const timeout = setTimeout(() => {
              reject(new Error('Timeout'));
            }, 10000); // 10 Ø«ÙˆØ§Ù†ÙŠ timeout

            img.onload = () => {
              clearTimeout(timeout);
              container.innerHTML = "";
              container.appendChild(img);
              setTimeout(() => img.style.opacity = "1", 50);
              resolve();
            };
            
            img.onerror = () => {
              clearTimeout(timeout);
              reject(new Error('Image load failed'));
            };
            
            img.src = url;
          });
        }

        document.getElementById("input")?.addEventListener("keypress", (e) => {
          if (e.key === "Enter") generateImage();
        });
    </script>
</body>
</html>
